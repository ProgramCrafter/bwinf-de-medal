{{#*inline "page"}}


<div class="columns">
   <div class="column is-12 is-offset-1">
      <nav class="breadcrumb" aria-label="breadcrumbs">
         <ul>
            <li></li>
            <li><a href="/">Startseite</a></li>
            {{#if is_admin}}
            <li><a href="/admin/">Administrationsübersicht</a></li>
            {{else}}
            <li><a href="/group/">Gruppenübersicht</a></li>
            <li><a href="/group/{{group_id}}">Gruppe  &nbsp; <em>{{group_name}}</em></a></li>
            <li><a href="/admin/group/{{group_id}}">Gruppenadministration</a></li>
            {{/if}}
            <li class="is-active"><a href=".">Benutzer  &nbsp; <em>{{firstname}} {{lastname}}</em></a></li>
         </ul>
      </nav>
   </div>
</div>
<div class="columns">
   <div class="column is-8 is-offset-2">
      <h3 class="title is-4">Benutzer „{{firstname}} {{lastname}}“</h3>
   </div>
</div>

<div class="columns">
  <div class="column is-5 is-offset-2">

<table class="table">
  <tr>
    <th>Vorname</th>
    <td>{{firstname}}</td>
  </tr>
  <tr>
    <th>Nachname</th>
    <td>{{lastname}}</td>
  </tr>
  <tr>
    <th>Benutzer-ID</th>
    <td>{{userid}}</td>
  </tr>
  <tr>
    <th>Status</th>
    <td>{{#if admin}}Administrator{{else}}{{#if teacher}}Lehrer{{else}}Schüler{{/if}}{{/if}}</td>
  </tr>
  <tr>
    <th>Jahrgangsstufe</th>
    <td>{{grade}}</td>
  </tr>
  {{#if logincode}}
    <tr>
      <th>Logincode</th>
      <td>{{logincode}}</td>
    </tr>
  {{/if}}
  {{#if is_admin}}
    {{#if oauthid}}
      <tr>
        <th>OAuth-Login</th>
        <td>{{oauthprovider}}</td>
      </tr>
      <tr>
        <th style="padding-left: 2em">{{oauthprovider}}-ID</th>
        <td>{{oauthid}}</td>
      </tr>
    {{/if}}
    {{#if username}}
      <tr>
        <th>Benutzername</th>
        <td>{{username}}</td>
      </tr>
    {{/if}}
  {{/if}}
</table>

</div>
<div class="column is-3">
<h4 class="title is-6">Benutzer „{{firstname}} {{lastname}}“ löschen:</h4>
{{#if can_delete }}
<form id="delete" action="" method="post">
  <input type="hidden" name="csrf_token" value="{{csrf_token}}">
  <input type="submit" value="Benutzer löschen!" class="button is-danger">
</form>
<div id="deleted" style="color:black;"></div>
{{else}}
Benutzer kann nur gelöscht werden, wenn er keine Teilnahmen besitzt.
{{/if}}
</div>
</div>

<div class="columns">
   <div class="column is-8 is-offset-2">
      <h4 class="title is-5">Gruppen</h4>

{{#if group}}
   <h5 class="title is-6">Admin von</h5>
      <table class="table">
         <tr>
            <th>Id</th>
            <th>Name</th>
            <th>Gruppencode</th>
            <th>Klassen-/Kursbez.</th>
         </tr>

         {{#each group}}
            <tr>
               <td><a href="/admin/group/{{id}}">{{id}}:</a></td>
               <td><a href="/admin/group/{{id}}">{{name}}</a></td>
               <td>{{code}}</td>
               <td>{{tag}}</td>
            </tr>
         {{/each}}
      </table>
{{/if}}

{{#if group_id }}
<h5 class="title is-6">Mitglied in</h5>
<ul>
   <li><a href="/admin/group/{{group_id}}">{{group_id}}: {{group_name}}</a></li>
</ul>
{{/if}}

</div>
</div>

<div class="columns">
   <div class="column is-8 is-offset-2">
      <h4 class="title is-5">Teilnahmen</h4>
<ul>
{{#each participations}}
   <li>– <a href="/admin/user/{{ ../userid }}/{{ this.0 }}">{{this.0}}: {{this.1}}</a></li>
{{/each}}
</ul>
  </div>
</div>

<script>
  document.getElementById("delete").onsubmit = function(event) {
    var xhr = new XMLHttpRequest();
    xhr.open("POST", window.location.href, true);
    xhr.onreadystatechange = function() {
      if (this.readyState === XMLHttpRequest.DONE) {
        if (this.status === 200) {
          result = JSON.parse(this.responseText);
          if (result.status == "ok") {
            document.getElementsByTagName("body")[0].style.color = "gray";
            document.getElementById("delete").style.display = "None";
            document.getElementById("deleted").innerText = "Benutzer gelöscht.";
          } else {
            alert("Kann Benutzer nicht löschen: " + result.reason);
          }
        }
        else {
          alert("Request error " + this.status + ": " + this.statusText);
        }
      }
    }
    xhr.send("csrf_token={{csrf_token}}");
    return false;
  };
</script>

{{/inline}}
{{~> (parent)~}}
